$(document).ready(function(){function e(t){for(var e,i,a=t.length;a;e=parseInt(Math.random()*a),i=t[--a],t[a]=t[e],t[e]=i);return t}function i(){$("#main-btn").html("Â¿QuÃ© me compro?"),$("#result").html("<p>ElegÃ­ una categorÃ­a y completÃ¡ cuanto queres gastar ğŸ¤”</p>").show(),$("#share").html("").hide()}function a(){$("#result").html("<p> No encontrÃ© nada por ese precio ğŸ˜¢</p>").show(),$("#share").html("").hide()}var n=1,r=[];let s="https://api.mercadolibre.com/sites/MLA/categories";$.getJSON(s,function(e){var i=[];for($.each(e,function(t,e){"MLA1071"==e.id||"MLA1540"==e.id||"MLA1512"==e.id||i.push({label:e.name,value:e.id})}),$("#hidden_categories").append(new Option("","")),t=0;t<i.length;t++)$("#hidden_categories").append(new Option(i[t].label,i[t].value));$("#hidden_categories option:first").attr("disabled","disabled")}),$("#hidden_categories").change(function(){i()}),$("#main-btn").click(function(){$(".product-img").fadeOut();let t=$("#tope").val(),s="MLA",l=$("#hidden_categories").val();if(""==t||""==l)return i(),!1;$(".form-signin").effect("shake"),$("#result").html("").hide(),$("#share").html("").hide();var p="https://api.mercadolibre.com/sites/"+s+"/search?status=active&category="+l;$.getJSON(p,function(i){if(void 0===i.results)a();else{var s=[];if($.each(i.results,function(e,i){i.price<=t&&!r.includes(i.id)&&s.push({id:i.id,price:i.price,thumbnail:i.thumbnail,title:i.title,permalink:i.permalink,free_shipping:i.shipping.free_shipping,listing_type:i.listing_type_id,difference:i.price/t*100})}),s.length<1)return a(),!1;e(s),e(s),r.push(s[0].id),s[0].thumbnail=s[0].thumbnail.replace("http://","https://");let l='<p><a target="_blank" href="'+s[0].permalink+'""><img src="'+s[0].thumbnail+'" class="product-img"></a></p>';l+='<p class="title">'+s[0].title+"</p>",l+='<p class="price">$ '+s[0].price+"</p>",s[0].free_shipping&&(l+='<p class="shipping">EnvÃ­o gratis</p>'),"gold_pro"==s[0].listing_type&&(l+='<p class="listing_type">Cuotas sin interes</p>'),l+='<a target="_blank" href="'+s[0].permalink+'" class="w-100 btn btn-lg btn-primary mb-3">Comprar ahora</a>',l+='<p class="divider"></p>';let p="Â¿No sabes quÃ© regalar esta navidad ğŸ„ğŸ„ğŸ„ ?";p+=" ğŸ“¦ ğŸ“¦ Busca tu prÃ³ximo regalo random en Mercado Libre ğŸ‘‡ ",$("#share").html('<a class="twitter-share-button" href="https://twitter.com/intent/tweet" data-size="large"  data-url="https://chcibelli.github.io/shake-n-buy/" data-text="'+p+'">Tweet</a>'),twttr.widgets.load(),1==n?($("#main-btn").html("Â¡Dame otra opciÃ³n!"),n=2):($("#main-btn").html("Â¡Mejor otra opciÃ³n mÃ¡s!"),n=1),$("#result").html(l),$("#result, #share").show()}})}),$("#tope").on("keypress",function(t){return 13==t.which?($("#main-btn").click(),!1):!(t.which>31&&(t.which<48||t.which>57))})});